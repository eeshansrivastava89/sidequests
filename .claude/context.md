# Session Context
<!-- Auto-generated by /context-save -->
<!-- Last saved: 2026-02-07 -->

## Project Anchor

**Project:** Projects Dashboard v2 — local web app scanning ~/dev as a "daily starting point" for developers
**Current Phase:** Phase 28 complete. Codex simplification plan (Chunks 1-4) complete. All uncommitted.

## Git State

**Branch:** main
**Last Commit:** f30ecc8 phase 23: UX polish — modal, actionable stats, list indicators
**Uncommitted Changes:** Phases 24-28 + Codex simplification across 25 files (+980 / -1363 lines net reduction)

## What We Did This Session

### Phase 28: Modal Layout Refinement
- Replaced collapsible `Section` component with always-visible `SectionBox` (bordered containers)
- 5 sections always visible: Now, Recent Work, Details, Workflow, O-1 Evidence (gated)
- Removed `ChevronIcon`, `Separator` imports (no longer needed)
- Font size nudge: `text-xs` → `text-sm` for commit messages, activity entries, fallback text
- Removed Export Evidence button from drawer (`onExport` prop removed)
- Updated IMPLEMENTATION_PLAN.md (Phase 28 ✅) and ARCHITECTURE.md (drawer description)

### Codex Simplification Plan (Agent Team — 3 parallel agents)
Implemented all 4 chunks from `.claude/codex-review.md`:

**Chunk 1: Contract & Type Unification** (types-agent)
- Removed `author` from `recentCommits` type in types.ts and merge.ts (scanner never emitted it)
- Fixed `license` type: `string | null` → `boolean` (matching scan.py output)
- Added `linterConfig`, `license`, `lockfile` keys to scan.py `check_files()` — health scoring signals were always 0
- Fixed derived tags merge bug: `parsJson(derivedData.tags as string)` → `Array.isArray` check

**Chunk 2: API Route Deduplication** (api-agent)
- Created `src/lib/api-helpers.ts` with 4 shared utilities: `withErrorHandler`, `findProject`/`notFound`, `coercePatchBody`, `safeJsonParse`
- Refactored 8 route files to use shared helpers
- All response shapes and status codes preserved

**Chunk 3: UI Dead Code Removal** (ui-agent)
- Deleted 3 unused files: `project-card.tsx`, `ui/card.tsx`, `ui/sheet.tsx`
- Created `src/lib/project-helpers.ts` — shared `healthColor`, `copyToClipboard`, `formatRelativeDate`, `formatRelativeTime`, `formatLastTouched`
- Created `src/components/project-icons.tsx` — shared VsCodeIcon, ClaudeIcon, CodexIcon, TerminalIcon, PinIcon
- Removed ~170 lines of duplicated code from project-list.tsx and project-drawer.tsx
- Removed unused `refreshing` state from use-projects.ts

**Chunk 4: Config Cleanup** (me)
- Deleted `config.example.json` (no references, env-only config)
- Deleted empty `next.config.ts`
- Moved `prisma` from dependencies to devDependencies

### Other
- Added `CLAUDE_CLI_MODEL=sonnet` to `.env.local` (was unset, now explicit)

## Decisions Made

| Decision | Rationale |
|----------|-----------|
| SectionBox replaces Section | Scrolling faster than clicking for daily-use tool |
| 5 sections not 4 | O-1 Evidence separate from Workflow — cleaner separation |
| Remove Export Evidence from drawer | Header "Export All" sufficient; per-project export never used |
| Remove `author` from recentCommits | Scanner never emitted it — `git log --format="%H\|%aI\|%s"` has no author |
| `license` type → boolean | scan.py emits bool, not string |
| Agent team for simplification | 3 chunks touch different files — safe parallel execution |
| Chunk 5 (schema consolidation) deferred | Highest migration risk, per Codex recommendation |
| CLAUDE_CLI_MODEL=sonnet | Explicit model choice for LLM enrichment |

## Working Model

- **Claude (me):** Implementer — writes code, runs agent teams
- **Codex:** Architect and code reviewer — reviews work, provides feedback
- User mediates between the two

## PM Review Backlog (Still Unaddressed)

**P1:** First-run empty state, keyboard nav focus handling
**P2:** "Recently Active" tab, auto-collapse refresh panel, persist tab to localStorage, pinned section styling
**P3:** Dark mode toggle, extract shared icons/healthColor (✅ done in Chunk 3)

## Next Actions

1. **Visual QA** — Test all changes in browser (modal layout, bordered sections, font sizes, keyboard shortcuts, toasts)
2. **Commit** — All uncommitted work: Phases 24-28 + Codex simplification (25 files, net -383 lines)
3. **Codex review** — Send for review of the simplification changes
4. **Address remaining PM backlog** — P1/P2 items

## Conversation Essence

- User wants Opus for agents — don't downgrade without asking
- User values honest code review: "have you actually read the code?" — always read before opining
- Product vision is "daily starting point" (PITCH.md is north star)
- Codex review doc lives at `.claude/codex-review.md`
- User prefers brainstorming before committing to implementation — propose, don't execute
- Agent teams used successfully for parallel simplification work
- All Phases 24-28 + simplification changes are uncommitted — commit when ready
- `.env.local` now has `CLAUDE_CLI_MODEL=sonnet`
- PITCH.md status line says "All 21 phases" — slightly stale but not a feature change
