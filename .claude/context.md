# Session Context
<!-- Auto-generated by /context-save -->
<!-- Last saved: 2026-01-31 -->

## Project Anchor

**Project:** Projects Dashboard v2 — local developer portfolio dashboard scanning ~/dev projects
**Current Phase:** Phase 8 complete (all 8 phases done), pending user testing of LLM refresh with new observability

## Git State

**Branch:** main
**Last Commit:** ec5f25e phase 2: deterministic pipeline
**Uncommitted Changes:**
- Phase 2 follow-ups: spawn timeout fix in pipeline.ts, .env.local.example updates
- Phase 3: LLM provider interface, 5 providers (claude-cli, openrouter, ollama, mlx, codex-cli), registry with unsafe gate
- Phase 4: API endpoints (GET/PATCH projects, o1 export, config)
- Phase 5: Full UI — dashboard page, project cards, detail drawer with Overview/Edit/Scan tabs, stats bar, workflow tabs
- Phase 6: O-1 evidence tab and export button (gated by FEATURE_O1)
- Phase 7: README rewrite, config.example.json, PITCH.md
- Phase 8: SSE refresh observability — streaming endpoint, progress panel, per-project tracking
- All uncommitted — nothing has been committed since Phase 2

## What We Were Doing

### Task
Building full projects dashboard from Phase 0 through Phase 8, with Codex as architect/reviewer and Claude as implementer.

### Progress
- [x] Phase 0: Setup (Next.js 16 + Tailwind v4 + shadcn/ui + Prisma 7/SQLite)
- [x] Phase 1: Data layer (7 Prisma tables, merge logic)
- [x] Phase 2: Deterministic pipeline (scan.py + derive.py + Node runner)
- [x] Phase 3: LLM integration (provider interface, 5 providers, unsafe gate, path sanitization)
- [x] Phase 4: API endpoints (7 routes, JSON field coercion)
- [x] Phase 5: UI (dashboard, cards, drawer, workflow views, status select, textarea)
- [x] Phase 6: O-1 export (evidence tab, export button, gated)
- [x] Phase 7: Docs and OSS (README, config.example.json, PITCH.md)
- [x] Phase 8: Refresh observability (SSE streaming, progress panel, abort signal, per-project activity logging)

### Where We Stopped
All 8 phases implemented and reviewed by Codex. Phase 8 review findings (all 3) were fixed:
1. SSE event renamed from `error` to `pipeline_error`
2. AbortSignal wired for client disconnect cancellation
3. Per-project activity log uses per-project `thisLlmResult` instead of aggregate counts

User was about to test the full workflow with LLM enabled (`FEATURE_LLM=true`, `FEATURE_O1=true`). They haven't yet restarted the dev server and clicked Refresh to see the new SSE progress panel in action.

## Decisions Made

| Decision | Rationale | Files |
|----------|-----------|-------|
| SSE over WebSocket for refresh | Simpler, unidirectional, native EventSource | src/app/api/refresh/stream/route.ts |
| Separate /api/refresh/stream (GET) | Keeps POST /api/refresh for CLI/curl backward compat | src/app/api/refresh/ |
| pipeline_error SSE event name | Avoids collision with browser native error event | stream/route.ts, use-refresh.ts |
| AbortSignal in pipeline | Stops wasting LLM calls when client disconnects | pipeline.ts |
| Per-project thisLlmResult | Accurate per-project activity logging | pipeline.ts |
| Provider registry with unsafe gate | codex-cli requires LLM_ALLOW_UNSAFE=true | src/lib/llm/index.ts |
| Status select dropdown (not free text) | Prevents invalid status values | project-drawer.tsx |
| Textarea for purpose/notes | Better UX for longer fields | project-drawer.tsx |
| PITCH.md for vision doc | Separate from README; reusable for launch/blog/ProductHunt | PITCH.md |

## Next Actions

1. User restarts dev server and tests full refresh with LLM + progress panel
2. Walk through all workflows interactively (user requested this before context save)
3. Commit all work (nothing committed since Phase 2 — massive uncommitted diff)
4. Potential future: polish UI design, add dark mode toggle, improve card aesthetics

## Conversation Essence

- Codex = architect/reviewer, Claude = implementer. Phased delivery with checkpoint reviews.
- User wants 99% automated, 1% override. LLM enrichment is core, not optional.
- User was frustrated by black-box refresh with no progress feedback — that's why Phase 8 exists.
- All features enabled: FEATURE_LLM=true, LLM_PROVIDER=claude-cli, FEATURE_O1=true, SANITIZE_PATHS=false
- User wants to open-source this eventually; PITCH.md captures the vision
- 10 projects currently in ~/dev
- User edited PITCH.md manually (changed "60+ days" to "61+ days", "no server" to "no external server", added "agentic providers are gated")
- Checkpoint reviews happen after Phases 1, 2, 4, 5, 6. Phase 8 also got a review.
- Status thresholds: 14/60/180 days (not 30/90/365 as originally documented)
- Health rubric: README +15, tests +20, CI +15, recent +20, remote +10, low TODOs +10, deploy +10
